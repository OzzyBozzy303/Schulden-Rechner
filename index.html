<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Schulden-Tracker Pro</title>
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --text: #e5e7eb;
      --muted: #94a3b8;
      --primary: #22c55e;
      --warn: #f59e0b;
      --danger: #ef4444;
      --border: #1f2937;
      --card: #0b1220;
      --accent: #38bdf8;
      --score-bad: #ef4444;
      --score-avg: #f59e0b;
      --score-good: #22c55e;
    }
    body { margin:0; font-family:Arial, sans-serif; background:var(--bg); color:var(--text); }
    header { background:var(--primary); color:#fff; padding:1rem; text-align:center; font-size:1.3rem; font-weight:bold; }
    .container { max-width:900px; margin:auto; padding:1rem; }
    .card { background:var(--panel); border-radius:12px; padding:1rem; margin-bottom:1rem; }
    input, select, textarea, button {
      padding:0.8rem; border-radius:8px; border:1px solid var(--border);
      background:var(--card); color:var(--text); width:100%;
    }
    button { background:var(--primary); color:#041118; border:none; cursor:pointer; font-weight:600; }
    button:hover { background:#16a34a; }
    .list .item { background:var(--card); border-radius:10px; padding:0.8rem; margin-bottom:0.6rem; }
    .status.offen { color:var(--warn); font-weight:bold; }
    .status.bezahlt { color:var(--primary); font-weight:bold; }
    .person-card { background:var(--card); border-radius:10px; padding:0.8rem; margin-bottom:0.6rem; }
    .score-badge { padding:4px 10px; border-radius:999px; font-size:0.85rem; font-weight:bold; }
    .score-bad { background:rgba(239,68,68,0.15); color:var(--score-bad); }
    .score-avg { background:rgba(245,158,11,0.15); color:var(--score-avg); }
    .score-good { background:rgba(34,197,94,0.15); color:var(--score-good); }
    .hidden { display:none; }
    .auth { max-width:400px; margin:15vh auto; background:var(--panel); padding:1rem; border-radius:12px; text-align:center; }
    .auth input { margin-bottom:0.5rem; }
  </style>
</head>
<body>
  <header>ðŸ“± Schulden-Tracker Pro</header>

  <!-- Passwort-Schutz -->
  <div id="login" class="auth">
    <h2>Zugang geschÃ¼tzt</h2>
    <p>Bitte Passwort eingeben:</p>
    <input type="password" id="pwdInput" placeholder="Passwort"/>
    <button onclick="checkPwd()">Ã–ffnen</button>
    <button onclick="setPwd()">Neues Passwort setzen</button>
    <p class="muted">Hinweis: Passwort wird nur lokal gespeichert.</p>
  </div>

  <!-- App -->
  <div id="app" class="container hidden">
    <div class="card">
      <form id="debtForm">
        <input type="text" id="name" placeholder="Name" required />
        <input type="number" id="amount" placeholder="Betrag (â‚¬)" required />
        <input type="date" id="date" />
        <select id="status">
          <option value="offen">Offen</option>
          <option value="bezahlt">Bezahlt</option>
        </select>
        <textarea id="note" placeholder="Notiz"></textarea>
        <button type="submit">âž• HinzufÃ¼gen</button>
      </form>
    </div>
    <div class="card">
      <h3>Ãœbersicht</h3>
      <div id="list"></div>
    </div>
    <div class="card">
      <h3>PersonenÃ¼bersicht & KreditwÃ¼rdigkeit</h3>
      <div id="people"></div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = "debts_secure_v2";
    const PWD_KEY = "debts_pwd_v2";
    let debts = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

    // Passwort prÃ¼fen
    function checkPwd() {
      const input = document.getElementById("pwdInput").value;
      const saved = localStorage.getItem(PWD_KEY);
      if (!saved || saved === hash(input)) {
        document.getElementById("login").classList.add("hidden");
        document.getElementById("app").classList.remove("hidden");
        render();
      } else {
        alert("Falsches Passwort!");
      }
    }
    function setPwd() {
      const p = prompt("Neues Passwort eingeben:");
      if (p) {
        localStorage.setItem(PWD_KEY, hash(p));
        alert("Passwort gespeichert.");
      }
    }
    function hash(str) {
      let h = 0;
      for (let i=0; i<str.length; i++) { h = (h<<5) - h + str.charCodeAt(i); h |= 0; }
      return h.toString();
    }

    // Formular
    const form = document.getElementById("debtForm");
    form.addEventListener("submit", e => {
      e.preventDefault();
      const debt = {
        id: Date.now(),
        name: document.getElementById("name").value,
        amount: parseFloat(document.getElementById("amount").value),
        date: document.getElementById("date").value,
        status: document.getElementById("status").value,
        note: document.getElementById("note").value
      };
      debts.push(debt);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(debts));
      form.reset();
      render();
    });

    // Render Ãœbersicht
    function render() {
      const list = document.getElementById("list");
      list.innerHTML = "";
      debts.forEach(d => {
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <strong>${d.name}</strong> â€“ ${d.amount.toFixed(2)} â‚¬<br>
          <span class="status ${d.status}">${d.status}</span> | ${d.date || ""}<br>
          Notiz: ${d.note || ""}
        `;
        list.appendChild(div);
      });

      // PersonenÃ¼bersicht
      const people = document.getElementById("people");
      people.innerHTML = "";
      const grouped = {};
      debts.forEach(d => {
        if (!grouped[d.name]) grouped[d.name] = {offen:0, bezahlt:0, items:[]};
        grouped[d.name].items.push(d);
        if (d.status==="bezahlt") grouped[d.name].bezahlt += d.amount;
        else grouped[d.name].offen += d.amount;
      });
      Object.keys(grouped).forEach(name=>{
        const info = grouped[name];
        const score = calcScore(info);
        const div = document.createElement("div");
        div.className = "person-card";
        div.innerHTML = `
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <strong>${name}</strong>
            <span class="score-badge ${score.cls}">Score: ${score.val}/100</span>
          </div>
          <div>Offen: ${info.offen.toFixed(2)} â‚¬ | Bezahlt: ${info.bezahlt.toFixed(2)} â‚¬</div>
          ${info.items.map(i=>`
            <div style="border-top:1px dashed ${'#1f2937'};margin-top:6px;padding-top:6px;">
              ${i.category||"â€”"} â€“ ${i.amount.toFixed(2)} â‚¬ (${i.status})
              <div class="muted small">${i.note||""} â€¢ ${i.date||""}</div>
            </div>`).join("")}
        `;
        people.appendChild(div);
      });
    }

    // KreditwÃ¼rdigkeits-Score
    function calcScore(info){
      let score=
